!function(){"use strict";function i(){}function a(e){if("string"!=typeof e)return new TypeError("Invalid argument elemID, expect string, get "+typeof e);var t=document.getElementById(e);return t||new Error("DOM element "+e+" not found")}function l(e,t){e.classList.remove("form__input--error","form__input--success"),0<t.length&&e.classList.add(t)}function s(e,t){e.hasAttribute("data-form-has-container")&&(e.parentNode.classList.remove("form__container--error","form__container--success"),0<t.length&&e.parentNode.classList.add(t))}function u(e,t){for(var r=function(e){var t=0,r=e,n=[];do{if("BODY"===(r=r.parentNode).tagName||"FORM"===r.tagName)break;for(var i=0,o=r.children.length;i<o;i++)if(r.children[i].classList.contains("form__feedback")){n.push(r.children[i]);break}}while("FIELDSET"!==r.tagName&&(t++,t<10));return n}(e),n=0,i=r.length;n<i;n++)r[n].classList.remove("form__feedback--error","form__feedback--loading","form__feedback--success"),0<t.length&&r[n].classList.add(t)}function c(e,t){e=d(e);e&&(e.classList.remove("form__fieldset--error","form__fieldset--success"),0<t.length&&e.classList.add(t))}function d(e){var t=0,r=e;do{if("BODY"===(r=r.parentNode).tagName||"FORM"===r.tagName)return null;if(r.classList.contains("form__fieldset"))return r}while(++t<10);return null}function f(e){e=("radio"!==e.getAttribute("type")?e.getAttribute("id"):e.getAttribute("name")).replace("-input-","-label-");return e+"-error"}function t(e){var t,r=document.getElementById(f(e));r&&(t=r.getAttribute("id").replace("-error",""),"radio"!==e.getAttribute("type")&&e.setAttribute("aria-labelledby",t),r.remove())}function o(e){e=e.previousElementSibling;null!==e&&"DIV"===e.tagName&&"alert"===e.getAttribute("role")&&e.remove()}function m(e,t){var r=e.rulesTextParts[e.idxOptionsTextParts].split(":"),n=new p;n[r[0]]?n[r[0]](r,e,t):t(new Error("Invalid rule "+r[0]))}function p(){}function h(e){for(var t=window,r=e.split("."),n=0,i=r.length;n<i-1;n++)if("window"!==r[n]&&void 0===(t=t[r[n]]))return;return t[r[r.length-1]]}function e(e){this.canSubmit=!0,this.formHelper=new i,this.listErrors=[],this.currentCallbacks={},e.addEventListener("submit",this.onSubmit.bind(this),{passive:!1});for(var t=0,r=e.length;t<r;t++){var n=e[t].getAttribute("type");"checkbox"===n||"radio"===n||"file"===n?e[t].addEventListener("change",this.onChange.bind(this),{passive:!1}):e[t].addEventListener("blur",this.onChange.bind(this),{passive:!1})}}i.prototype.setFieldNeutral=function(e){e=a(e);if(!(e instanceof HTMLElement))return e;e.setAttribute("aria-invalid","false"),l(e,""),s(e,""),u(e,""),c(e,""),t(e)},i.prototype.setFieldValid=function(e){e=a(e);if(!(e instanceof HTMLElement))return e;e.setAttribute("aria-invalid","false"),l(e,"form__input--success"),s(e,"form__container--success"),u(e,"form__feedback--success"),c(e,"form__fieldset--success"),t(e)},i.prototype.setFieldInvalid=function(e,t){var r,n,i,o=a(e);return o instanceof HTMLElement?"string"!=typeof t?new TypeError("Invalid argument errorMessage, expect string, get "+typeof t):t.length<1?new Error("Argument errorMessage is empty"):(o.setAttribute("aria-invalid","true"),l(o,"form__input--error"),s(o,"form__container--error"),u(o,"form__feedback--error"),c(o,"form__fieldset--error"),n=t,i=f(r=o),void((e=document.getElementById(i))?e.textContent=n:(t=document.createElement("label"),e=r.getAttribute("id").replace("-input-","-label-"),t.classList.add("form__label","form__label--error"),t.setAttribute("for",r.getAttribute("id")),t.setAttribute("id",i),t.appendChild(document.createTextNode(n)),"radio"!==r.getAttribute("type")?(r.setAttribute("aria-labelledby",e+" "+i),(r.hasAttribute("data-form-has-container")?r.parentNode:r).insertAdjacentElement("afterend",t)):(t.removeAttribute("for"),(r=d(r))&&r.appendChild(t))))):o},i.prototype.setFieldLoading=function(e){e=a(e);if(!(e instanceof HTMLElement))return e;l(e,""),s(e,""),u(e,"form__feedback--loading"),c(e,""),t(e)},i.prototype.removeGeneralError=function(e){e=a(e);if(!(e instanceof HTMLElement))return e;o(e)},i.prototype.setGeneralError=function(e,t,r){var n=a(e);if(!(n instanceof HTMLElement))return n;if("string"!=typeof t)return new TypeError("Invalid argument title, expect string, get "+typeof t);if(t.length<1)return new Error("Argument title is empty");if("[object Array]"!==Object.prototype.toString.call(r))return new TypeError("Invalid argument listErrors, expect Array, get "+typeof r);if(0===r.length)return new Error("Argument listErrors is empty");var i=function(e){for(var t=0,r=e.length;t<r;t++){if(!e[t]||"object"!=typeof e[t])return new Error("Invalid argument listErrors["+t+"], expect Object");if(!e[t].hasOwnProperty("id")||"string"!=typeof e[t].id)return new Error("Invalid argument listErrors["+t+"].id, expect string");if(e[t].id.length<1)return new Error("Invalid argument listErrors["+t+"].id is empty");if(!e[t].hasOwnProperty("message")||"string"!=typeof e[t].message)return new Error("Invalid argument listErrors["+t+"].message, expect string");if(e[t].message.length<1)return new Error("Invalid argument listErrors["+t+"].message is empty");if(e[t].hasOwnProperty("more")&&"string"!=typeof e[t].more)return new Error("Invalid argument listErrors["+t+"].more, expect string")}return null}(r);if(i)return i;i=e,(e=document.createElement("div")).setAttribute("role","alert"),e.classList.add("block__info","block__info--error"),e.setAttribute("id",i+"-error"),i=e,e=t,(t=document.createElement("h4")).classList.add("block__title","block__title--small"),t.appendChild(document.createTextNode(e)),r=function(e){var t=document.createElement("ul");t.classList.add("block__list");for(var r=0,n=e.length;r<n;r++){var i=document.createElement("li");i.classList.add("block__list-item");var o=document.createElement("a");o.classList.add("block__list-link"),o.setAttribute("href","#"+e[r].id),o.appendChild(document.createTextNode(e[r].message)),i.appendChild(o),e[r].more&&0<e[r].more.length&&(i.appendChild(document.createElement("br")),i.appendChild(document.createTextNode(e[r].more))),t.appendChild(i)}return t}(r);i.appendChild(t),i.appendChild(r),o(n),n.insertAdjacentElement("beforebegin",i)},i.prototype.tryFieldIsInvalid=function(e,t,r){if("function"!=typeof r)return new TypeError("Invalid argument callback, expect function, get "+typeof r);var n,i=a(e);if(!(i instanceof HTMLElement))return r(i);"string"==typeof t?(n=i.value.trim(),e=t.split("|"),function t(r,n){r.idxOptionsTextParts<r.maxOptionsTextParts?m(r,function(e){null!==e?n(e):(r.idxOptionsTextParts++,t(r,n))}):n(null)}({elemObj:i,val:n,len:n.length,idxOptionsTextParts:0,rulesTextParts:e,maxOptionsTextParts:e.length},r)):r(new TypeError("Invalid argument rulesText, expect string, get "+typeof t))},p.prototype.required=function(e,t,r){0===t.len?r(e[0]):r(null)},p.prototype.min=function(e,t,r){e[1]=e[1]>>0,0!==e[1]?t.len<e[1]?r(e[0]):r(null):r(new Error("Invalid parameter rule min, expect number above 0"))},p.prototype.max=function(e,t,r){e[1]=e[1]>>0,0!==e[1]?t.len>e[1]?r(e[0]):r(null):r(new Error("Invalid parameter rule max, expect number above 0"))},p.prototype.email=function(e,t,r){var n=t.val.indexOf("@");n<1||n===t.len-1?r(e[0]):r(null)},p.prototype.equal_field=function(e,t,r){var n=document.getElementById(e[1]);n?t.val!==n.value.trim()?r(e[0]):r(null):r(new Error("Invalid parameter rule equal_field, DOM element "+e[1]+" not found"))},p.prototype.aria_invalid=function(e,t,r){"true"===t.elemObj.getAttribute("aria-invalid")?r(e[0]):r(null)},p.prototype.callback=function(e,t,r){if(e[1]){var n=h(e[1]);if(n){var i=[t.elemObj,function(e){r(!0===e?null:"callback")}];if(e[2])for(var o=e[2].split(","),a=0;a<o.length;a++)i.push(o[a]);n.apply(null,i)}else r(new Error("Invalid parameter rule callback, callback "+e[1]+" not found"))}else r(new Error("Invalid parameter rule callback, callback "+e[1]+" not found"))},p.prototype.regex=function(e,t,r){var n=e.slice(1).join(":");new RegExp(n).exec(t.elemObj.value)?r(null):r(e[0])},p.prototype.checked=function(e,t,r){if("radio"===t.elemObj.getAttribute("type")){var n=t.elemObj.getAttribute("name");if(!n||n.length<1)r(new Error("Attribute name is missing for "+t.elemObj.getAttribute("id")));else{for(var i=document.getElementsByName(n),o=!1,a=0;a<i.length;a++)i[a].checked&&(o=!0);r(o?null:e[0])}}else t.elemObj.checked?r(null):r(e[0])},e.prototype.onChange=function(e){var t;!1!==this.canSubmit?(t=Date.now(),this.currentCallbacks[e.currentTarget.id]=t,function(e){if("file"===e.getAttribute("type")){var t=e.getAttribute("data-form-file-empty")||"Choose file";if(0<e.files.length){for(var r=[],n=0;n<e.files.length;n++)r.push(e.files[n].name);t=r.join(", ")}for(var i=0,o=e.parentNode.children.length;i<o;i++)e.parentNode.children[i].classList.contains("form__fake-file-label")&&(e.parentNode.children[i].textContent=t)}}(e.currentTarget),this.checkFieldState(e.currentTarget,!1,t)):e.preventDefault()},e.prototype.onSubmit=function(e){if(e.preventDefault(),!1===this.canSubmit)return new Error("Form is already in submit processing");for(var t in this.currentCallbacks)this.currentCallbacks[t]=-1;this.canSubmit=!1,this.form=e.currentTarget,this.currentIdxNodes=0,this.maxNodes=this.form.length,this.hasError=!1,this.listErrors=[],this.checkFormFieldsState(this.canFinallySubmit.bind(this))},e.prototype.checkFormFieldsState=function(e){this.currentIdxNodes<this.maxNodes?this.checkFieldState(this.form[this.currentIdxNodes],!0,null,function(){this.currentIdxNodes++,this.checkFormFieldsState(e)}.bind(this)):e()},e.prototype.checkFieldState=function(r,n,i,o){var a=r.getAttribute("id"),e=r.getAttribute("data-form-rules");null!==a&&null!==e?(this.formHelper.setFieldLoading(a),this.formHelper.tryFieldIsInvalid(a,e,function(e){var t;null!==i&&this.currentCallbacks[a]&&this.currentCallbacks[a]!==i||(t=this.setFieldState(e,r),n&&null!==e&&(this.hasError=!0,this.listErrors.push({id:a,message:t})),o&&o(e))}.bind(this))):o&&o(null)},e.prototype.setFieldState=function(e,t){var r;return null!==e?("string"==typeof e?(r=t.getAttribute("data-form-error-"+e))&&0!==e.length||(r="Invalid field"):r="Error: "+e.message,this.formHelper.setFieldInvalid(t.getAttribute("id"),r)):this.formHelper.setFieldValid(t.getAttribute("id")),r},e.prototype.canFinallySubmit=function(){if(this.hasError){var e=this.form.getAttribute("data-form-general-error");if(e)this.formHelper.setGeneralError(this.form.getAttribute("id"),e,this.listErrors);else{for(var t=[],r=0;r<this.listErrors.length;r++)t.push(this.listErrors[r].message);e=this.form.getAttribute("data-form-speak-error")||"Form is invalid:";"function"==typeof window.screenReaderSpeak&&window.screenReaderSpeak(e+" "+t.join(", "))}this.canSubmit=!0}else this.callConfirmCallback()||this.showConfirm()||this.form.submit()},e.prototype.callConfirmCallback=function(){var e=this.form.getAttribute("data-form-confirm-callback");if(!e)return!1;e=h(e);return!!e&&(e.apply(null,[this.form,function(e){e?this.form.submit():this.canSubmit=!0}.bind(this)]),!0)},e.prototype.showConfirm=function(){if(!this.form.hasAttribute("data-form-confirm"))return!1;var e=document.getElementById("popin-confirm-h2"),t=document.getElementById("popin-confirm-div-content");if(!e||!t)return!1;var r=document.getElementById("popin-confirm-button-yes");r&&r.remove();var n=document.getElementById("popin-confirm-button-no");n&&n.remove();r=document.createElement("button");r.setAttribute("class","form__button form__button--small"),r.setAttribute("id","popin-confirm-button-yes");n=document.createElement("button");return n.setAttribute("class","form__button form__button--secondary form__button--small"),n.setAttribute("id","popin-confirm-button-no"),e.textContent=this.form.getAttribute("data-form-confirm-question")||"Do you confirm?",r.appendChild(document.createTextNode(this.form.getAttribute("data-form-confirm-yes")||"Yes")),n.appendChild(document.createTextNode(this.form.getAttribute("data-form-confirm-no")||"No")),t.appendChild(r),t.appendChild(n),r.addEventListener("click",this.confirmYes.bind(this)),n.addEventListener("click",this.confirmNo.bind(this)),this.previousHash=window.location.hash,window.location.hash="#popin-confirm",!0},e.prototype.confirmYes=function(){this.form.submit()},e.prototype.confirmNo=function(){this.canSubmit=!0,window.location.hash=this.previousHash},window.FormHelper=i;for(var r=document.querySelectorAll("form"),n=0,b=r.length;n<b;n++)new e(r[n])}();