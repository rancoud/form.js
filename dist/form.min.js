/**
 * form.js (v1.0.0)
 * https://github.com/rancoud/form.js
 * 
 * MIT License
 * 
 * Copyright (c) 2023 Rancoud
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(){"use strict";function s(e){for(var t=window,r=e.split("."),n=0,i=r.length;n<i-1;n++)if("window"!==r[n]&&void 0===(t=t[r[n]]))return;return t[r[r.length-1]]}function a(){}function i(){}function u(e){return"string"!=typeof e?new TypeError("Invalid argument elemID, expect string, get "+typeof e):document.getElementById(e)||new Error("DOM element "+e+" not found")}function c(e,t){e.classList.remove("form__input--error","form__input--success"),0<t.length&&e.classList.add(t)}function d(e,t){e.hasAttribute("data-form-has-container")&&(e.parentNode.classList.remove("form__container--error","form__container--success"),0<t.length)&&e.parentNode.classList.add(t)}function m(o,e){for(var t=function(){var e,t=0,r=o,n=[],i=0;do{if("BODY"===(r=r.parentNode).tagName||"FORM"===r.tagName)break;for(i=0,e=r.children.length;i<e;++i)if(r.children[i].classList.contains("form__feedback")){n.push(r.children[i]);break}}while("FIELDSET"!==r.tagName&&(t+=1)<10);return n}(),r=0,n=t.length;r<n;r++)t[r].classList.remove("form__feedback--error","form__feedback--loading","form__feedback--success"),0<e.length&&t[r].classList.add(e)}function f(e,t){var r=p(e);r&&(r.classList.remove("form__fieldset--error","form__fieldset--success"),0<t.length)&&r.classList.add(t)}function p(e){var t=0,r=e;do{if("BODY"===(r=r.parentNode).tagName||"FORM"===r.tagName)return null;if(r.classList.contains("form__fieldset"))return r}while((t+=1)<10);return null}function h(e){return("radio"!==e.getAttribute("type")?e.getAttribute("id"):e.getAttribute("name")).replace("-input-","-label-")+"-error"}function r(e){var t,r=document.getElementById(h(e));r&&(t=r.getAttribute("id").replace("-error",""),"radio"!==e.getAttribute("type")&&e.setAttribute("aria-labelledby",t),r.remove())}function b(e){var t=e.previousElementSibling;null!==t&&"DIV"===t.tagName&&"alert"===t.getAttribute("role")&&t.remove()}function e(e){var t,r=0,n=e.length;for(this.canSubmit=!0,this.formHelper=new i,this.listErrors=[],this.currentCallbacks={},e.addEventListener("submit",this.onSubmit.bind(this),{passive:!1});r<n;++r)"checkbox"===(t=e[r].getAttribute("type"))||"radio"===t||"file"===t?e[r].addEventListener("change",this.onChange.bind(this),{passive:!1}):e[r].addEventListener("blur",this.onChange.bind(this),{passive:!1})}a.prototype.required=function(e,t,r){0===t.len?r(e[0]):r(null)},a.prototype.min=function(e,t,r){e[1]=e[1]>>0,0===e[1]?r(new Error("Invalid parameter rule min, expect number above 0")):t.len<e[1]?r(e[0]):r(null)},a.prototype.max=function(e,t,r){e[1]=e[1]>>0,0===e[1]?r(new Error("Invalid parameter rule max, expect number above 0")):t.len>e[1]?r(e[0]):r(null)},a.prototype.email=function(e,t,r){var n=t.val.indexOf("@");n<1||n===t.len-1?r(e[0]):r(null)},a.prototype.equal_field=function(e,t,r){var n=document.getElementById(e[1]);n?t.val!==n.value.trim()?r(e[0]):r(null):r(new Error("Invalid parameter rule equal_field, DOM element "+e[1]+" not found"))},a.prototype.aria_invalid=function(e,t,r){"true"===t.elemObj.getAttribute("aria-invalid")?r(e[0]):r(null)},a.prototype.callback=function(e,t,r){var n,i,o=null,l=[],a=0;if(e[1])if(o=s(e[1])){if(l=[t.elemObj,function(e){r(!0===e?null:"callback")}],e[2])for(i=(n=e[2].split(",")).length;a<i;++a)l.push(n[a]);o.apply(null,l)}else r(new Error("Invalid parameter rule callback, callback "+e[1]+" not found"));else r(new Error("Invalid parameter rule callback, callback "+e[1]+" not found"))},a.prototype.regex=function(e,t,r){var n=e.slice(1).join(":");new RegExp(n).exec(t.elemObj.value)?r(null):r(e[0])},a.prototype.checked=function(e,t,r){var n,i,o,l=!1,a=0;if("radio"===t.elemObj.getAttribute("type"))if(!(n=t.elemObj.getAttribute("name"))||n.length<1)r(new Error("Attribute name is missing for "+t.elemObj.getAttribute("id")));else{for(l=!1,o=(i=document.getElementsByName(n)).length;a<o;++a)i[a].checked&&(l=!0);r(l?null:e[0])}else t.elemObj.checked?r(null):r(e[0])},i.prototype.setFieldNeutral=function(e){var t=u(e);if(!(t instanceof HTMLElement))return t;t.setAttribute("aria-invalid","false"),c(t,""),d(t,""),m(t,""),f(t,""),r(t)},i.prototype.setFieldValid=function(e){var t=u(e);if(!(t instanceof HTMLElement))return t;t.setAttribute("aria-invalid","false"),c(t,"form__input--success"),d(t,"form__container--success"),m(t,"form__feedback--success"),f(t,"form__fieldset--success"),r(t)},i.prototype.setFieldInvalid=function(e,t){var r,n,i,o,l,a,s=u(e);return s instanceof HTMLElement?"string"!=typeof t?new TypeError("Invalid argument errorMessage, expect string, get "+typeof t):t.length<1?new Error("Argument errorMessage is empty"):(s.setAttribute("aria-invalid","true"),c(s,"form__input--error"),d(s,"form__container--error"),m(s,"form__feedback--error"),f(s,"form__fieldset--error"),n=t,i=h(r=s),a=l=null,void((o=document.getElementById(i))?o.textContent=n:(l=document.createElement("label"),o=r.getAttribute("id").replace("-input-","-label-"),l.classList.add("form__label","form__label--error"),l.setAttribute("for",r.getAttribute("id")),l.setAttribute("id",i),l.appendChild(document.createTextNode(n)),"radio"!==r.getAttribute("type")?(r.setAttribute("aria-labelledby",o+" "+i),(r.hasAttribute("data-form-has-container")?r.parentNode:r).insertAdjacentElement("afterend",l)):(l.removeAttribute("for"),(a=p(r))&&a.appendChild(l))))):s},i.prototype.setFieldLoading=function(e){var t=u(e);if(!(t instanceof HTMLElement))return t;c(t,""),d(t,""),m(t,"form__feedback--loading"),f(t,""),r(t)},i.prototype.removeGeneralError=function(e){var t=u(e);if(!(t instanceof HTMLElement))return t;b(t)},i.prototype.setGeneralError=function(e,t,r){var n,i,o,l=u(e);return l instanceof HTMLElement?"string"!=typeof t?new TypeError("Invalid argument title, expect string, get "+typeof t):t.length<1?new Error("Argument title is empty"):"[object Array]"!==Object.prototype.toString.call(r)?new TypeError("Invalid argument listErrors, expect Array, get "+typeof r):0===r.length?new Error("Argument listErrors is empty"):function(e){for(var t=0,r=e.length;t<r;t++){if(!e[t]||"object"!=typeof e[t])return new Error("Invalid argument listErrors["+t+"], expect Object");if(!e[t].hasOwnProperty("id")||"string"!=typeof e[t].id)return new Error("Invalid argument listErrors["+t+"].id, expect string");if(e[t].id.length<1)return new Error("Invalid argument listErrors["+t+"].id is empty");if(!e[t].hasOwnProperty("message")||"string"!=typeof e[t].message)return new Error("Invalid argument listErrors["+t+"].message, expect string");if(e[t].message.length<1)return new Error("Invalid argument listErrors["+t+"].message is empty");if(e[t].hasOwnProperty("more")&&"string"!=typeof e[t].more)return new Error("Invalid argument listErrors["+t+"].more, expect string")}return null}(r)||(n=e,(i=document.createElement("div")).setAttribute("role","alert"),i.classList.add("block__info","block__info--error"),i.setAttribute("id",n+"-error"),n=i,i=t,(o=document.createElement("h4")).classList.add("block__title","block__title--small"),o.appendChild(document.createTextNode(i)),i=o,o=function(e){for(var t=document.createElement("ul"),r=(t.classList.add("block__list"),0),n=e.length;r<n;r++){var i=document.createElement("li"),o=(i.classList.add("block__list-item"),document.createElement("a"));o.classList.add("block__list-link"),o.setAttribute("href","#"+e[r].id),o.appendChild(document.createTextNode(e[r].message)),i.appendChild(o),e[r].more&&0<e[r].more.length&&(i.appendChild(document.createElement("br")),i.appendChild(document.createTextNode(e[r].more))),t.appendChild(i)}return t}(r),n.appendChild(i),n.appendChild(o),b(l),void l.insertAdjacentElement("beforebegin",n)):l},i.prototype.tryFieldIsInvalid=function(e,t,r){var n,i,o=null;return"function"!=typeof r?new TypeError("Invalid argument callback, expect function, get "+typeof r):(o=u(e))instanceof HTMLElement?void("string"!=typeof t?r(new TypeError("Invalid argument rulesText, expect string, get "+typeof t)):(n=o.value.trim(),i=t.split("|"),function t(r,n){var e,i,o,l;r.idxOptionsTextParts<r.maxOptionsTextParts?(i=function(e){null!==e?n(e):(r.idxOptionsTextParts++,t(r,n))},(l=new a)[(o=(e=r).rulesTextParts[e.idxOptionsTextParts].split(":"))[0]]?l[o[0]](o,e,i):i(new Error("Invalid rule "+o[0]))):n(null)}({elemObj:o,val:n,len:n.length,idxOptionsTextParts:0,rulesTextParts:i,maxOptionsTextParts:i.length},r))):r(o)},e.prototype.onChange=function(e){var t=Date.now();if(!1===this.canSubmit)e.preventDefault();else{this.currentCallbacks[e.currentTarget.id]=t;var r,n,i=e.currentTarget,o="",l=[],a=0,s=0;if("file"===i.getAttribute("type")){if(o=i.getAttribute("data-form-file-empty")||"Choose file",0<i.files.length){for(l=[],r=i.files.length;a<r;++a)l.push(i.files[a].name);o=l.join(", ")}for(n=i.parentNode.children.length;s<n;++s)i.parentNode.children[s].classList.contains("form__fake-file-label")&&(i.parentNode.children[s].textContent=o)}this.checkFieldState(e.currentTarget,!1,t)}},e.prototype.onSubmit=function(e){if(e.preventDefault(),!1===this.canSubmit)return new Error("Form is already in submit processing");for(var t in this.currentCallbacks)this.currentCallbacks[t]=-1;this.canSubmit=!1,this.form=e.currentTarget,this.currentIdxNodes=0,this.maxNodes=this.form.length,this.hasError=!1,this.listErrors=[],this.checkFormFieldsState(this.canFinallySubmit.bind(this))},e.prototype.checkFormFieldsState=function(e){this.currentIdxNodes<this.maxNodes?this.checkFieldState(this.form[this.currentIdxNodes],!0,null,(function(){this.currentIdxNodes+=1,this.checkFormFieldsState(e)}).bind(this)):e()},e.prototype.checkFieldState=function(t,r,n,i){var o,l=t.getAttribute("id"),e=t.getAttribute("data-form-rules");null===l||null===e?i&&i(null):(this.formHelper.setFieldLoading(l),this.formHelper.tryFieldIsInvalid(l,e,(function(e){null!==n&&this.currentCallbacks[l]&&this.currentCallbacks[l]!==n||(o=this.setFieldState(e,t),r&&null!==e&&(this.hasError=!0,this.listErrors.push({id:l,message:o})),i&&i(e))}).bind(this)))},e.prototype.setFieldState=function(e,t){var r=null;return null===e?this.formHelper.setFieldValid(t.getAttribute("id")):("string"==typeof e?(r=t.getAttribute("data-form-error-"+e))&&0!==e.length||(r="Invalid field"):r="Error: "+e.message,this.formHelper.setFieldInvalid(t.getAttribute("id"),r)),r},e.prototype.canFinallySubmit=function(){var e,t=[],r=0,n=this.listErrors.length;if(this.hasError){if(e=this.form.getAttribute("data-form-general-error"))this.formHelper.setGeneralError(this.form.getAttribute("id"),e,this.listErrors);else{for(t=[];r<n;++r)t.push(this.listErrors[r].message);e=this.form.getAttribute("data-form-speak-error")||"Form is invalid:","function"==typeof window.screenReaderSpeak&&window.screenReaderSpeak(e+" "+t.join(", "))}this.canSubmit=!0}else this.callConfirmCallback()||this.showConfirm()||this.form.submit()},e.prototype.callConfirmCallback=function(){var e=null,t=this.form.getAttribute("data-form-confirm-callback");return!!t&&!!(e=s(t))&&(e.apply(null,[this.form,(function(e){e?this.form.submit():this.canSubmit=!0}).bind(this)]),!0)},e.prototype.showConfirm=function(){var e=null,t=null,r=null,n=null,i=null,o=null;return!(!this.form.hasAttribute("data-form-confirm")||(e=document.getElementById("popin-confirm-h2"),t=document.getElementById("popin-confirm-div-content"),!e)||!t||((r=document.getElementById("popin-confirm-button-yes"))&&r.remove(),(n=document.getElementById("popin-confirm-button-no"))&&n.remove(),(i=document.createElement("button")).setAttribute("class","form__button form__button--small"),i.setAttribute("id","popin-confirm-button-yes"),(o=document.createElement("button")).setAttribute("class","form__button form__button--secondary form__button--small"),o.setAttribute("id","popin-confirm-button-no"),e.textContent=this.form.getAttribute("data-form-confirm-question")||"Do you confirm?",i.appendChild(document.createTextNode(this.form.getAttribute("data-form-confirm-yes")||"Yes")),o.appendChild(document.createTextNode(this.form.getAttribute("data-form-confirm-no")||"No")),t.appendChild(i),t.appendChild(o),i.addEventListener("click",this.confirmYes.bind(this)),o.addEventListener("click",this.confirmNo.bind(this)),this.previousHash=window.location.hash,window.location.hash="#popin-confirm",0))},e.prototype.confirmYes=function(){this.form.submit()},e.prototype.confirmNo=function(){this.canSubmit=!0,window.location.hash=this.previousHash},window.Form=e}();