/**
 * form.js (v1.0.0)
 * https://github.com/rancoud/form.js
 * 
 * MIT License
 * 
 * Copyright (c) 2023 Rancoud
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(){"use strict";function s(e){for(var t=window,r=e.split("."),n=0,i=r.length;n<i-1;++n)if("window"!==r[n]&&void 0===(t=t[r[n]]))return;return t[r[r.length-1]]}function l(){}l.prototype.required=function(e,t,r){0===t.len?r(e[0]):r(null)},l.prototype.min=function(e,t,r){e[1]=e[1]>>0,0===e[1]?r(new Error("Invalid parameter rule min, expect number above 0")):t.len<e[1]?r(e[0]):r(null)},l.prototype.max=function(e,t,r){e[1]=e[1]>>0,0===e[1]?r(new Error("Invalid parameter rule max, expect number above 0")):t.len>e[1]?r(e[0]):r(null)},l.prototype.email=function(e,t,r){var n=t.val.indexOf("@");n<1||n===t.len-1?r(e[0]):r(null)},l.prototype.equal_field=function(e,t,r){var n=document.getElementById(e[1]);n?t.val!==n.value.trim()?r(e[0]):r(null):r(new Error("Invalid parameter rule equal_field, DOM element "+e[1]+" not found"))},l.prototype.aria_invalid=function(e,t,r){"true"===t.elemObj.getAttribute("aria-invalid")?r(e[0]):r(null)},l.prototype.callback=function(e,t,r){var n,i,o,a,l=0;if(e[1])if(n=s(e[1])){if(i=[t.elemObj,function(e){r(!0===e?null:"callback")}],e[2])for(a=(o=e[2].split(",")).length;l<a;++l)i.push(o[l]);n.apply(null,i)}else r(new Error("Invalid parameter rule callback, callback "+e[1]+" not found"));else r(new Error("Invalid parameter rule callback, callback "+e[1]+" not found"))},l.prototype.regex=function(e,t,r){var n=e.slice(1).join(":");new RegExp(n).exec(t.elemObj.value)?r(null):r(e[0])},l.prototype.checked=function(e,t,r){var n,i,o,a,l=0;if("radio"===t.elemObj.getAttribute("type"))if(!(n=t.elemObj.getAttribute("name"))||n.length<1)r(new Error("Attribute name is missing for "+t.elemObj.getAttribute("id")));else{for(o=!1,a=(i=document.getElementsByName(n)).length;l<a;++l)i[l].checked&&(o=!0);r(o?null:e[0])}else t.elemObj.checked?r(null):r(e[0])};var a=10;function i(){}function c(e){return"string"!=typeof e?new TypeError("Invalid argument elemID, expect string, get "+typeof e):document.getElementById(e)||new Error("DOM element "+e+" not found")}function u(e,t){e.classList.remove("form__input--error","form__input--success"),0<t.length&&e.classList.add(t)}function d(e,t){e.hasAttribute("data-form-has-container")&&(e.parentNode.classList.remove("form__container--error","form__container--success"),0<t.length)&&e.parentNode.classList.add(t)}function m(o,e){for(var t=function(){var e,t,r=0,n=o,i=[];do{if("BODY"===(n=n.parentNode).tagName||"FORM"===n.tagName)break;for(e=0,t=n.children.length;e<t;++e)if(n.children[e].classList.contains("form__feedback")){i.push(n.children[e]);break}}while("FIELDSET"!==n.tagName&&(r+=1)<a);return i}(),r=0,n=t.length;r<n;++r)t[r].classList.remove("form__feedback--error","form__feedback--loading","form__feedback--success"),0<e.length&&t[r].classList.add(e)}function f(e,t){var r=p(e);r&&(r.classList.remove("form__fieldset--error","form__fieldset--success"),0<t.length)&&r.classList.add(t)}function p(e){var t=0,r=e;do{if("BODY"===(r=r.parentNode).tagName||"FORM"===r.tagName)return null;if(r.classList.contains("form__fieldset"))return r}while((t+=1)<a);return null}function h(e){return("radio"!==e.getAttribute("type")?e.getAttribute("id"):e.getAttribute("name")).replace("-input-","-label-")+"-error"}function r(e){var t,r=document.getElementById(h(e));r&&(t=r.getAttribute("id").replace("-error",""),"radio"!==e.getAttribute("type")&&e.setAttribute("aria-labelledby",t),r.remove())}function b(e){var t=e.previousElementSibling;null!==t&&"DIV"===t.tagName&&"alert"===t.getAttribute("role")&&t.remove()}function e(e){var t,r=0,n=e.length;for(this.canSubmit=!0,this.formHelper=new i,this.listErrors=[],this.currentCallbacks={},e.addEventListener("submit",this.onSubmit.bind(this),{passive:!1});r<n;++r)"checkbox"===(t=e[r].getAttribute("type"))||"radio"===t||"file"===t?e[r].addEventListener("change",this.onChange.bind(this),{passive:!1}):e[r].addEventListener("blur",this.onChange.bind(this),{passive:!1})}i.prototype.setFieldNeutral=function(e){var t=c(e);if(!(t instanceof HTMLElement))return t;t.setAttribute("aria-invalid","false"),u(t,""),d(t,""),m(t,""),f(t,""),r(t)},i.prototype.setFieldValid=function(e){var t=c(e);if(!(t instanceof HTMLElement))return t;t.setAttribute("aria-invalid","false"),u(t,"form__input--success"),d(t,"form__container--success"),m(t,"form__feedback--success"),f(t,"form__fieldset--success"),r(t)},i.prototype.setFieldInvalid=function(e,t){var r,n,i,o,a,l=c(e);return l instanceof HTMLElement?"string"!=typeof t?new TypeError("Invalid argument errorMessage, expect string, get "+typeof t):t.length<1?new Error("Argument errorMessage is empty"):(l.setAttribute("aria-invalid","true"),u(l,"form__input--error"),d(l,"form__container--error"),m(l,"form__feedback--error"),f(l,"form__fieldset--error"),i=t,o=h(r=l),void((a=document.getElementById(o))?a.textContent=i:(a=document.createElement("label"),n=r.getAttribute("id").replace("-input-","-label-"),a.classList.add("form__label","form__label--error"),a.setAttribute("for",r.getAttribute("id")),a.setAttribute("id",o),a.appendChild(document.createTextNode(i)),"radio"!==r.getAttribute("type")?(r.setAttribute("aria-labelledby",n+" "+o),(r.hasAttribute("data-form-has-container")?r.parentNode:r).insertAdjacentElement("afterend",a)):(a.removeAttribute("for"),(i=p(r))&&i.appendChild(a))))):l},i.prototype.setFieldLoading=function(e){var t=c(e);if(!(t instanceof HTMLElement))return t;u(t,""),d(t,""),m(t,"form__feedback--loading"),f(t,""),r(t)},i.prototype.removeGeneralError=function(e){var t=c(e);if(!(t instanceof HTMLElement))return t;b(t)},i.prototype.setGeneralError=function(e,t,r){var n,i,o,a=c(e);return a instanceof HTMLElement?"string"!=typeof t?new TypeError("Invalid argument title, expect string, get "+typeof t):t.length<1?new Error("Argument title is empty"):"[object Array]"!==Object.prototype.toString.call(r)?new TypeError("Invalid argument listErrors, expect Array, get "+typeof r):0===r.length?new Error("Argument listErrors is empty"):function(e){for(var t=0,r=e.length;t<r;++t){if(!e[t]||"object"!=typeof e[t])return new Error("Invalid argument listErrors["+t+"], expect Object");if(!e[t].hasOwnProperty("id")||"string"!=typeof e[t].id)return new Error("Invalid argument listErrors["+t+"].id, expect string");if(e[t].id.length<1)return new Error("Invalid argument listErrors["+t+"].id is empty");if(!e[t].hasOwnProperty("message")||"string"!=typeof e[t].message)return new Error("Invalid argument listErrors["+t+"].message, expect string");if(e[t].message.length<1)return new Error("Invalid argument listErrors["+t+"].message is empty");if(e[t].hasOwnProperty("more")&&"string"!=typeof e[t].more)return new Error("Invalid argument listErrors["+t+"].more, expect string")}return null}(r)||(n=e,(i=document.createElement("div")).setAttribute("role","alert"),i.classList.add("block__info","block__info--error"),i.setAttribute("id",n+"-error"),n=i,i=t,(o=document.createElement("h4")).classList.add("block__title","block__title--small"),o.appendChild(document.createTextNode(i)),i=o,o=function(e){var t,r,n,i=0,o=document.createElement("ul");for(o.classList.add("block__list"),t=e.length;i<t;++i)(r=document.createElement("li")).classList.add("block__list-item"),(n=document.createElement("a")).classList.add("block__list-link"),n.setAttribute("href","#"+e[i].id),n.appendChild(document.createTextNode(e[i].message)),r.appendChild(n),e[i].more&&0<e[i].more.length&&(r.appendChild(document.createElement("br")),r.appendChild(document.createTextNode(e[i].more))),o.appendChild(r);return o}(r),n.appendChild(i),n.appendChild(o),b(a),void a.insertAdjacentElement("beforebegin",n)):a},i.prototype.tryFieldIsInvalid=function(e,t,r){var n,i,o;return"function"!=typeof r?new TypeError("Invalid argument callback, expect function, get "+typeof r):(n=c(e))instanceof HTMLElement?void("string"!=typeof t?r(new TypeError("Invalid argument rulesText, expect string, get "+typeof t)):(i=n.value.trim(),o=t.split("|"),function t(r,n){var e,i,o,a;r.idxOptionsTextParts<r.maxOptionsTextParts?(i=function(e){null===e?(r.idxOptionsTextParts=r.idxOptionsTextParts+1,t(r,n)):n(e)},(a=new l)[(o=(e=r).rulesTextParts[e.idxOptionsTextParts].split(":"))[0]]?a[o[0]](o,e,i):i(new Error("Invalid rule "+o[0]))):n(null)}({elemObj:n,val:i,len:i.length,idxOptionsTextParts:0,rulesTextParts:o,maxOptionsTextParts:o.length},r))):r(n)},e.prototype.onChange=function(e){var t=Date.now();if(!1===this.canSubmit)e.preventDefault();else{this.currentCallbacks[e.currentTarget.id]=t;var r,n,i,o,a=e.currentTarget,l=0,s=0;if("file"===a.getAttribute("type")){if(r=a.getAttribute("data-form-file-empty")||"Choose file",0<a.files.length){for(n=[],i=a.files.length;l<i;++l)n.push(a.files[l].name);r=n.join(", ")}for(o=a.parentNode.children.length;s<o;++s)a.parentNode.children[s].classList.contains("form__fake-file-label")&&(a.parentNode.children[s].textContent=r)}this.checkFieldState(e.currentTarget,!1,t)}},e.prototype.onSubmit=function(e){if(e.preventDefault(),!1===this.canSubmit)return new Error("Form is already in submit processing");for(var t in this.currentCallbacks)Object.hasOwn(this.currentCallbacks,t)&&(this.currentCallbacks[t]=-1);this.canSubmit=!1,this.form=e.currentTarget,this.currentIdxNodes=0,this.maxNodes=this.form.length,this.hasError=!1,this.listErrors=[],this.checkFormFieldsState(this.canFinallySubmit.bind(this))},e.prototype.checkFormFieldsState=function(e){this.currentIdxNodes<this.maxNodes?this.checkFieldState(this.form[this.currentIdxNodes],!0,null,(function(){this.currentIdxNodes=this.currentIdxNodes+1,this.checkFormFieldsState(e)}).bind(this)):e()},e.prototype.checkFieldState=function(t,r,n,i){var o,a=t.getAttribute("id"),e=t.getAttribute("data-form-rules");null===a||null===e?i&&i(null):(this.formHelper.setFieldLoading(a),this.formHelper.tryFieldIsInvalid(a,e,(function(e){null!==n&&this.currentCallbacks[a]&&this.currentCallbacks[a]!==n||(o=this.setFieldState(e,t),r&&null!==e&&(this.hasError=!0,this.listErrors.push({id:a,message:o})),i&&i(e))}).bind(this)))},e.prototype.setFieldState=function(e,t){var r=null;return null===e?this.formHelper.setFieldValid(t.getAttribute("id")):("string"==typeof e?(r=t.getAttribute("data-form-error-"+e))&&0!==e.length||(r="Invalid field"):r="Error: "+e.message,this.formHelper.setFieldInvalid(t.getAttribute("id"),r)),r},e.prototype.canFinallySubmit=function(){var e,t,r=0,n=this.listErrors.length;if(this.hasError){if(t=this.form.getAttribute("data-form-general-error"))this.formHelper.setGeneralError(this.form.getAttribute("id"),t,this.listErrors);else{for(e=[];r<n;++r)e.push(this.listErrors[r].message);t=this.form.getAttribute("data-form-speak-error")||"Form is invalid:","function"==typeof window.screenReaderSpeak&&window.screenReaderSpeak(t+" "+e.join(", "))}this.canSubmit=!0}else this.callConfirmCallback()||this.showConfirm()||this.form.submit()},e.prototype.callConfirmCallback=function(){var e=this.form.getAttribute("data-form-confirm-callback");return!!e&&!!(e=s(e))&&(e.apply(null,[this.form,(function(e){e?this.form.submit():this.canSubmit=!0}).bind(this)]),!0)},e.prototype.showConfirm=function(){var e,t,r,n;return!(!this.form.hasAttribute("data-form-confirm")||(e=document.getElementById("popin-confirm-h2"),t=document.getElementById("popin-confirm-div-content"),!e)||!t||((r=document.getElementById("popin-confirm-button-yes"))&&r.remove(),(r=document.getElementById("popin-confirm-button-no"))&&r.remove(),(r=document.createElement("button")).setAttribute("class","form__button form__button--small"),r.setAttribute("id","popin-confirm-button-yes"),(n=document.createElement("button")).setAttribute("class","form__button form__button--secondary form__button--small"),n.setAttribute("id","popin-confirm-button-no"),e.textContent=this.form.getAttribute("data-form-confirm-question")||"Do you confirm?",r.appendChild(document.createTextNode(this.form.getAttribute("data-form-confirm-yes")||"Yes")),n.appendChild(document.createTextNode(this.form.getAttribute("data-form-confirm-no")||"No")),t.appendChild(r),t.appendChild(n),r.addEventListener("click",this.confirmYes.bind(this)),n.addEventListener("click",this.confirmNo.bind(this)),this.previousHash=window.location.hash,window.location.hash="#popin-confirm",0))},e.prototype.confirmYes=function(){this.form.submit()},e.prototype.confirmNo=function(){this.canSubmit=!0,window.location.hash=this.previousHash},window.Form=e}();